from abc import ABC, abstractmethod
from typing import Optional

from ..utils.type_utils import OutcomeDict


class BasePredictor(ABC):
    """
    Abstract base class for all predictors.
    """

    @abstractmethod
    def predict_judgment(self, fact: str) -> OutcomeDict:
        """
        Predicts the standard accusation judgment based on the provided fact.

        Args:
            fact (str): The fact to analyze.

        Returns:
            list[tuple[str, int]]: A list of tuples containing the accusation and its score.
        """
        raise NotImplementedError("This method should be overridden by subclasses.")

    @abstractmethod
    def predict_standard_accusation(self, fact: str) -> dict[str, str]:
        """
        Predicts the standard accusation based on the provided fact.

        Args:
            fact (str): The fact to analyze.

        Returns:
            dict[str, str]: A dictionary containing the standard accusation.
        """
        raise NotImplementedError("This method should be overridden by subclasses.")

    def predict_imprisonment(
        self, fact: str, standard_accusation: Optional[str] = None
    ) -> dict[str, int]:
        """
        Predicts the imprisonment based on the provided fact and standard accusation.

        Args:
            fact (str): The fact to analyze.
            standard_accusation (str, optional): The standard accusation to consider. Defaults to None.

        Returns:
            dict[str, int]: A dictionary containing the imprisonment judgment.
        """
        if standard_accusation is None:
            standard_accusation = self.predict_standard_accusation(fact)

        assert self._is_valid_accusation(
            standard_accusation
        ), f"Invalid accusation: {standard_accusation}"

        return self._predict_imprisonment_with_standard_accusation(
            fact, standard_accusation
        )

    @abstractmethod
    def _predict_imprisonment_with_standard_accusation(
        self, fact: str, standard_accusation: str
    ) -> dict[str, int]:
        """
        Predicts the imprisonment based on the provided fact.

        Args:
            fact (str): The fact to analyze.
            standard_accusation (str): The standard accusation to consider.

        Returns:
            dict[str, int]: A dictionary containing the imprisonment judgment.
        """
        raise NotImplementedError("This method should be overridden by subclasses.")

    @staticmethod
    def _is_valid_accusation(accusation: str) -> bool:
        """
        Checks if the provided accusation is valid.

        Args:
            accusation (str): The accusation to validate.

        Returns:
            bool: True if the accusation is valid, False otherwise.
        """
        # Placeholder for actual validation logic
        valid_accusations = [
            "伪证罪",
            "假冒专利罪",
            "故意泄露国家秘密罪",
            "运送他人偷越国（边）境罪",
            "破坏计算机信息系统罪",
            "伪造、变造、买卖武装部队公文、证件、印章罪",
            "伪造货币罪",
            "聚众冲击军事禁区罪",
            "刑讯逼供罪",
            "违规披露、不披露重要信息罪",
            "扰乱法庭秩序罪",
            "过失以危险方法危害公共安全罪",
            "利用未公开信息交易罪",
            "非法生产、买卖、运输制毒物品、走私制毒物品罪",
            "虐待被监管人罪",
            "非法携带枪支、弹药、管制刀具、危险物品危及公共安全罪",
            "侮辱罪",
            "组织淫秽表演罪",
            "非法经营同类营业罪",
            "侵犯公民个人信息罪",
            "袭警罪",
            "破坏电力设备罪",
            "扰乱无线电通讯管理秩序罪",
            "非法利用信息网络罪",
            "冒充军人招摇撞骗罪",
            "金融凭证诈骗罪",
            "串通投标罪",
            "私分罚没财物罪",
            "损害商业信誉、商品声誉罪",
            "集资诈骗罪",
            "非法购买增值税专用发票、购买伪造的增值税专用发票罪",
            "妨害作证罪",
            "引诱、教唆、欺骗他人吸毒罪",
            "非法生产、买卖警用装备罪",
            "内幕交易、泄露内幕信息罪",
            "保险诈骗罪",
            "为亲友非法牟利罪",
            "行贿罪",
            "虚开发票罪",
            "销售侵权复制品罪",
            "消防责任事故罪",
            "伪造、变造、买卖身份证件罪",
            "寻衅滋事罪",
            "组织、利用会道门、邪教组织、利用迷信致人重伤、死亡罪",
            "走私贵重金属罪",
            "盗掘古人类化石、古脊椎动物化石罪",
            "交通肇事罪",
            "非法批准征收、征用、占用土地罪",
            "伪造、变造金融票证罪",
            "窃取、收买、非法提供信用卡信息罪",
            "聚众斗殴罪",
            "破坏易燃易爆设备罪",
            "过失损坏武器装备、军事设施、军事通信罪",
            "组织、资助非法聚集罪",
            "非法获取国家秘密罪",
            "伪造、变造、买卖国家机关公文、证件、印章罪",
            "编造、故意传播虚假信息罪",
            "帮助毁灭、伪造证据罪",
            "贪污罪",
            "侵犯著作权罪",
            "伪造公司、企业、事业单位、人民团体印章罪",
            "生产、销售不符合卫生标准的化妆品罪",
            "滥用职权罪",
            "妨害动植物防疫、检疫罪",
            "非法出售发票罪",
            "签订、履行合同失职被骗罪",
            "虚假诉讼罪",
            "倒卖文物罪",
            "盗窃、侮辱、故意毁坏尸体、尸骨、骨灰罪",
            "利用影响力受贿罪",
            "违法发放林木采伐许可证罪",
            "私放在押人员罪",
            "非法制造、买卖、运输、邮寄、储存枪支、弹药、爆炸物罪",
            "受贿罪",
            "提供伪造、变造的出入境证件罪",
            "失职造成珍贵文物损毁、流失罪",
            "组织残疾人、儿童乞讨罪",
            "生产、销售伪劣农药、兽药、化肥、种子罪",
            "猥亵儿童罪",
            "虚开增值税专用发票、用于骗取出口退税、抵扣税款发票罪",
            "非法制造、出售非法制造的用于骗取出口退税、抵扣税款发票罪",
            "生产、销售伪劣产品罪",
            "盗伐林木罪",
            "伪造、盗窃、买卖、非法提供、非法使用武装部队专用标志罪",
            "拒不支付劳动报酬罪",
            "暴力取证罪",
            "逃避追缴欠税罪",
            "非法侵入住宅罪",
            "私分国有资产罪",
            "赌博罪",
            "单位受贿罪",
            "非法持有、私藏枪支、弹药罪",
            "帮助信息网络犯罪活动罪",
            "走私国家禁止进出口的货物、物品罪",
            "玩忽职守罪",
            "绑架罪",
            "不报、谎报安全事故罪",
            "逃避商检罪",
            "协助组织卖淫罪",
            "聚众哄抢罪",
            "强迫交易罪",
            "非法使用窃听、窃照专用器材罪",
            "强迫卖淫罪",
            "徇私舞弊减刑、假释、暂予监外执行罪",
            "破坏选举罪",
            "生产、销售不符合安全标准的产品罪",
            "非法经营罪",
            "失职致使在押人员脱逃罪",
            "破坏交通设施罪",
            "非法进行节育手术罪",
            "走私废物罪",
            "失火罪",
            "动植物检疫徇私舞弊罪",
            "劫夺被押解人员罪",
            "包庇毒品犯罪分子罪",
            "吸收客户资金不入账罪",
            "走私珍贵动物、珍贵动物制品罪",
            "破坏武器装备、军事设施、军事通信罪",
            "盗窃、抢夺、毁灭国家机关公文、证件、印章罪",
            "引诱幼女卖淫罪",
            "非法猎捕、收购、运输、出售陆生野生动物罪",
            "脱逃罪",
            "徇私舞弊不移交刑事案件罪",
            "组织、领导传销活动罪",
            "盗掘古文化遗址、古墓葬罪",
            "挪用特定款物罪",
            "扰乱国家机关工作秩序罪",
            "非法出售用于骗取出口退税、抵扣税款发票罪",
            "擅自发行股票、公司、企业债券罪",
            "生产、销售不符合标准的医用器材罪",
            "侵犯商业秘密罪",
            "包庇、纵容黑社会性质组织罪",
            "过失损坏广播电视设施、公用电信设施罪",
            "民事、行政枉法裁判罪",
            "代替考试罪",
            "投放危险物质罪",
            "打击报复证人罪",
            "编造、故意传播虚假恐怖信息罪",
            "销售假冒注册商标的商品罪",
            "收买被拐卖的妇女、儿童罪",
            "故意损毁文物罪",
            "虚假广告罪",
            "非法狩猎罪",
            "走私、贩卖、运输、制造毒品罪",
            "信用卡诈骗罪",
            "欺诈发行证券罪",
            "假冒注册商标罪",
            "危害珍贵、濒危野生动物罪",
            "妨害清算罪",
            "对非国家工作人员行贿罪",
            "强令、组织他人违章冒险作业罪",
            "非法收购、运输盗伐、滥伐的林木罪",
            "单位行贿罪",
            "传授犯罪方法罪",
            "非法制造、出售非法制造的发票罪",
            "票据诈骗罪",
            "滥伐林木罪",
            "组织未成年人进行违反治安管理活动罪",
            "盗窃罪",
            "非法捕捞水产品罪",
            "对单位行贿罪",
            "劫持船只、汽车罪",
            "工程重大安全事故罪",
            "骗购外汇罪",
            "帮助犯罪分子逃避处罚罪",
            "抢劫罪",
            "伪造、出售伪造的增值税专用发票罪",
            "敲诈勒索罪",
            "非法出售增值税专用发票罪",
            "遗弃罪",
            "拐卖妇女、儿童罪",
            "放火罪",
            "过失损毁文物罪",
            "催收非法债务罪",
            "非法行医罪",
            "危险物品肇事罪",
            "生产、销售不符合安全标准的食品罪",
            "拒不执行判决、裁定罪",
            "出售、购买、运输假币罪",
            "虐待罪",
            "虚假破产罪",
            "过失致人死亡罪",
            "辩护人、诉讼代理人毁灭证据、伪造证据、妨害作证罪",
            "传播淫秽物品罪",
            "生产、销售有毒、有害食品罪",
            "爆炸罪",
            "破坏监管秩序罪",
            "妨害传染病防治罪",
            "制作、复制、出版、贩卖、传播淫秽物品牟利罪",
            "强迫他人吸毒罪",
            "国有公司、企业、事业单位人员失职罪",
            "非法处置查封、扣押、冻结的财产罪",
            "非法获取计算机信息系统数据、非法控制计算机信息系统罪",
            "挪用公款罪",
            "妨害公务罪",
            "环境监管失职罪",
            "传播性病罪",
            "职务侵占罪",
            "掩饰、隐瞒犯罪所得、犯罪所得收益罪",
            "非法种植毒品原植物罪",
            "过失投放危险物质罪",
            "徇私枉法罪",
            "倒卖车票、船票罪",
            "非法集会、游行、示威罪",
            "危险驾驶罪",
            "宣扬恐怖主义、极端主义、煽动实施恐怖活动罪",
            "骗取出境证件罪",
            "引诱、容留、介绍卖淫罪",
            "逃汇罪",
            "出售出入境证件罪",
            "组织考试作弊罪",
            "出具证明文件重大失实罪",
            "非法侵入计算机信息系统罪",
            "组织、领导、参加黑社会性质组织罪",
            "抢夺罪",
            "走私普通货物、物品罪",
            "高利转贷罪",
            "非法生产、销售专用间谍器材、窃听、窃照专用器材罪",
            "重婚罪",
            "洗钱罪",
            "挪用资金罪",
            "非法采矿罪",
            "开设赌场罪",
            "破坏生产经营罪",
            "强奸罪",
            "提供侵入、非法控制计算机信息系统程序、工具罪",
            "使用虚假身份证件、盗用身份证件罪",
            "持有、使用假币罪",
            "重大责任事故罪",
            "侮辱国旗、国徽、国歌罪",
            "非国家工作人员受贿罪",
            "投放虚假危险物质罪",
            "非法生产、买卖武装部队制式服装罪",
            "过失损坏易燃易爆设备罪",
            "非法搜查罪",
            "食品、药品监管渎职罪",
            "信用证诈骗罪",
            "污染环境罪",
            "诽谤罪",
            "执行判决、裁定滥用职权罪",
            "违法发放贷款罪",
            "破坏交通工具罪",
            "聚众扰乱社会秩序罪",
            "窝藏、包庇罪",
            "过失损坏电力设备罪",
            "组织他人偷越国（边）境罪",
            "容留他人吸毒罪",
            "操纵证券、期货市场罪",
            "提供虚假证明文件罪",
            "非法处置进口的固体废物罪",
            "强制猥亵、侮辱罪",
            "非法制造、销售非法制造的注册商标标识罪",
            "强迫劳动罪",
            "故意损毁名胜古迹罪",
            "大型群众性活动重大安全事故罪",
            "违规出具金融票证罪",
            "组织出卖人体器官罪",
            "逃税罪",
            "招收公务员、学生徇私舞弊罪",
            "非法持有毒品罪",
            "贷款诈骗罪",
            "教育设施重大安全事故罪",
            "组织卖淫罪",
            "徇私舞弊不征、少征税款罪",
            "合同诈骗罪",
            "伪造、倒卖伪造的有价票证罪",
            "阻碍军人执行职务罪",
            "介绍贿赂罪",
            "非法吸收公众存款罪",
            "组织、利用会道门、邪教组织、利用迷信破坏法律实施罪",
            "有价证券诈骗罪",
            "非法出租、出借枪支罪",
            "危害国家重点保护植物罪",
            "聚众淫乱罪",
            "虚报注册资本罪",
            "骗取贷款、票据承兑、金融票证罪",
            "破坏广播电视设施、公用电信设施罪",
            "虐待被监护、看护人罪",
            "伪造、变造国家有价证券罪",
            "巨额财产来源不明罪",
            "持有伪造的发票罪",
            "故意毁坏财物罪",
            "招摇撞骗罪",
            "妨害信用卡管理罪",
            "虚假出资、抽逃出资罪",
            "拐骗儿童罪",
            "诈骗罪",
            "医疗事故罪",
            "过失爆炸罪",
            "组织越狱罪",
            "破坏性采矿罪",
            "非法拘禁罪",
            "生产、销售、提供假药罪",
            "以危险方法危害公共安全罪",
            "走私武器、弹药罪",
            "过失致人重伤罪",
            "偷越国（边）境罪",
            "故意伤害罪",
            "非法组织卖血罪",
            "骗取出口退税罪",
            "侵占罪",
            "聚众扰乱公共场所秩序、交通秩序罪",
            "放纵走私罪",
            "铁路运营安全事故罪",
            "对有影响力的人行贿罪",
            "过失决水罪",
            "非法买卖、运输、携带、持有毒品原植物种子、幼苗罪",
            "盗窃、抢夺枪支、弹药、爆炸物、危险物质罪",
            "聚众冲击国家机关罪",
            "重大劳动安全事故罪",
            "非法占用农用地罪",
            "非法制造、买卖、运输、储存危险物质罪",
            "非法转让、倒卖土地使用权罪",
            "故意杀人罪",
            "侵犯通信自由罪",
            "隐匿、故意销毁会计凭证、会计账簿、财务会计报告罪",
            "窝藏、转移、隐瞒毒品、毒赃罪",
            "诬告陷害罪",
            "非法出售、提供试题、答案罪",
            "非法低价出让国有土地使用权罪",
            "国有公司、企业、事业单位人员滥用职权罪",
        ]
        return accusation in valid_accusations
